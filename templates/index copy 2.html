<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Primary 5 Maths Game</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
    <style>
        body {
            font-family: Arial, sans-serif;
            color: black;
            background-image: url('{{ url_for('static', filename=background_image) }}');
        }
        #game {
            font-weight: bold;
        }
        #finalMessage {
            font-size: 20px;
            color: red;
        }
        #answerInput {
            width: 200px;
            padding: 5px;
            font-size: 16px;
        }
        .alert {
            padding: 10px;
            background-color: #f44336; /* Red */
            color: white;
            margin-bottom: 15px;
        }
    </style>
</head>
<body>
    <div id="level-selection">
        <label for="levelSelect">Choose a level:</label>
        <select id="levelSelect">
            <option value="1">Level 1</option>
            <option value="2">Level 2</option>
            <option value="3">Level 3</option>
            <option value="4">Level 4</option>
            <option value="5">Level 5</option>
            <option value="6">Level 6</option>
            <option value="7">Level 7</option>
            <option value="8">Level 8</option>
            <option value="9">Level 9</option>
            <option value="10">Level 10</option>
            <option value="11">Level 11</option>
            <option value="12">Level 12</option>
            <option value="13">Level 13</option>
            <option value="14">Level 14</option>
            <option value="15">Level 15</option>
            <option value="16">Level 16</option>
        </select>
        <button id="startGameButton">Start Game</button>
    </div>
    
    <!-- Flash messages display -->
    {% with messages = get_flashed_messages(with_categories=true) %}
      {% if messages %}
        {% for category, message in messages %}
          <div class="alert alert-{{ category }}">
            {{ message }}
          </div>
        {% endfor %}
      {% endif %}
    {% endwith %}

    <div id="game">
        <h1>Primary 5 Maths Game - Level <span id="level">1</span></h1>
        <div id="timer">45:00</div>
        <div id="question-progress">Question: 0/14</div>
        <div id="questionDisplay">{{ question }}</div>
        <input type="text" id="answerInput">
        <button id="submitButton" onclick="submitAnswer()">Submit Answer</button>
        <div id="scoreDisplay">Score: 0</div>
        <div id="finalMessage"></div>
        <img id="animeImage" style="display: none; width: 300px; height: auto;" src="" alt="Anime Art">
    </div>

    <script>
        function startGame() {
            const selectedLevel = document.getElementById('levelSelect').value;
            fetch(`/start_game?level=${selectedLevel}`, { method: 'GET' })
                .then(response => response.json())
                .then(data => {
                    document.getElementById('level').textContent = selectedLevel;
                    document.getElementById('questionDisplay').textContent = data.question;
                    document.getElementById('scoreDisplay').textContent = "Score: 0";
                    document.getElementById('finalMessage').textContent = "";
                    document.getElementById('answerInput').style.display = 'inline';
                    document.getElementById('submitButton').style.display = 'inline';
                })
                .catch(error => console.error('Error starting the game:', error));
        }

        function submitAnswer() {
            const userAnswer = document.getElementById('answerInput').value;
            fetch('/submit_answer', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({user_answer: userAnswer})
            })
            .then(response => response.json())
            .then(data => {
                if (data.game_over) {
                    document.getElementById('finalMessage').textContent = data.final_message;
                    document.getElementById('answerInput').style.display = 'none';
                    document.getElementById('submitButton').style.display = 'none';
                } else {
                    document.getElementById('questionDisplay').textContent = data.next_question;
                    document.getElementById('scoreDisplay').textContent = "Score: " + data.score;
                    document.getElementById('answerInput').value = ''; // Clear the input field
                }
                alert(data.correct ? "Correct!" : `Incorrect! Correct answer was: ${data.correct_answer}`);
            })
            .catch(error => console.error('Error:', error));
        }
    </script>
</body>
</html>